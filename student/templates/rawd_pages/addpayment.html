{% extends "./base/base.html" %}
{% load static %}

{% block title %}إضافة دفعة{% endblock %}

{% block content %}
<div class="container-fluid mt-3">
  <div class="card shadow-sm rounded-3">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">➕ إضافة دفعة جديدة</h5>
    </div>
    <div class="card-body">
      <form method="post" class="row g-3">
        {% csrf_token %}

        <!-- Student Search -->
        <div class="col-12">
          <label for="student" class="form-label">اختر الطالب</label>
          <select id="student" name="student" class="form-select" required></select>
        </div>

        <!-- Payment Type -->
        <div class="col-6">
          <label class="form-label">نوع الدفع</label>
          <select name="type" class="form-select" required>
            <option value="monthly">شهري</option>
            <option value="annual">سنوي</option>
          </select>
        </div>

        <!-- Amount -->
        <div class="col-6">
          <label class="form-label">المبلغ</label>
          <input type="number" step="0.01" name="amount" class="form-control" required>
        </div>

        <!-- Payment Date -->
        <div class="col-6">
          <label class="form-label">تاريخ الدفع</label>
          <input type="date" name="payment_date" class="form-control" required>
        </div>

        <!-- Description -->

        <div class="col-12">
          <label class="form-label">الوصف</label>
          <textarea name="description" class="form-control" rows="2"></textarea>
        </div>

        <!-- Submit -->
        <div class="col-12 d-grid">
          <button type="submit" class="btn btn-success">💾 حفظ</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Include Select2 -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  $(document).ready(function() {
    $('#student').select2({
      placeholder: '🔍 ابحث عن الطالب بالاسم',
      minimumInputLength: 1,
      ajax: {
        url: "{% url 'search_students' %}",
        dataType: 'json',
        delay: 250,
        data: function (params) {
          return { q: params.term };
        },
        processResults: function (data) {
          return { results: data.results };
        },
        cache: true
      },
      width: '100%'
    });
  });
</script>
{% endblock %}
